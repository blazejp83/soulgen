---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - tailwind.config.ts
  - postcss.config.mjs
  - src/app/layout.tsx
  - src/app/page.tsx
  - src/app/globals.css
  - src/lib/utils.ts
  - src/stores/settings-store.ts
  - src/stores/wizard-store.ts
  - src/types/index.ts
  - components.json
autonomous: true
---

<objective>
Scaffold the Next.js project with shadcn/ui, create Zustand stores with localStorage persistence for wizard state and settings, and define core TypeScript types.

Purpose: Establish the project foundation that all subsequent plans build on — the app shell, design system, state management, and type definitions.
Output: Running Next.js app with Zustand stores persisting to localStorage, shadcn/ui configured, core types defined.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md

Reference files for output format understanding:
@SOUL.md
@IDENTITY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js project with shadcn/ui and Tailwind</name>
  <files>package.json, tsconfig.json, next.config.ts, tailwind.config.ts, postcss.config.mjs, src/app/layout.tsx, src/app/page.tsx, src/app/globals.css, src/lib/utils.ts, components.json</files>
  <action>
    1. Initialize Next.js 15 project with App Router, TypeScript, Tailwind CSS, src/ directory:
       `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --use-pnpm --yes`
       (Use pnpm. If the directory isn't empty, the reference .md files exist — move them to a temp location first, scaffold, move them back.)

    2. Initialize shadcn/ui:
       `npx shadcn@latest init --defaults --yes`
       This sets up components.json, cn() utility, CSS variables for theming.

    3. Add initial shadcn components needed for Phase 1:
       `npx shadcn@latest add button input label select slider switch tabs card toast`

    4. Set up a minimal app layout in src/app/layout.tsx:
       - Import globals.css
       - Use Inter font from next/font/google
       - Set metadata: title "SoulGen", description "AI Agent Personality Wizard"
       - Dark mode by default (add `dark` class to html element)
       - Include Toaster from shadcn for notifications

    5. Create a placeholder homepage (src/app/page.tsx):
       - Simple centered layout with project name and brief tagline
       - "Get Started" button (links to /wizard — doesn't exist yet, that's fine)
       - "Settings" link (links to /settings — will be built in Plan 02)

    Do NOT install AI SDK or provider packages yet — that's Plan 02.
  </action>
  <verify>
    - `pnpm run dev` starts without errors
    - `pnpm run build` completes successfully
    - Navigating to localhost:3000 shows the placeholder page
  </verify>
  <done>Next.js app running with shadcn/ui, Tailwind CSS, dark mode, and placeholder homepage</done>
</task>

<task type="auto">
  <name>Task 2: Create TypeScript types and Zustand stores with localStorage persistence</name>
  <files>src/types/index.ts, src/stores/settings-store.ts, src/stores/wizard-store.ts</files>
  <action>
    1. Define core types in src/types/index.ts:

       ```
       // LLM Provider types
       type Provider = 'openai' | 'anthropic' | 'openrouter'

       interface ProviderConfig {
         apiKey: string
         model: string
       }

       // Mode toggle
       type AppMode = 'simple' | 'advanced'

       // Temperament sliders (all 0-100, default 50 = neutral)
       interface Temperament {
         valence: number      // pessimistic ↔ optimistic
         energy: number       // calm ↔ energized
         warmth: number       // cold ↔ empathetic
         dominance: number    // gentle ↔ assertive
         stability: number    // reactive ↔ stable
         autonomy: number     // dependent ↔ independent
       }

       // Communication style
       interface CommunicationStyle {
         formality: number    // casual ↔ formal (0-100)
         humor: number        // none ↔ frequent (0-5)
         directness: number   // diplomatic ↔ blunt (0-100)
         responseLength: 'concise' | 'balanced' | 'thorough'
         structurePreference: 'prose' | 'mixed' | 'structured'
         jargonLevel: number  // plain ↔ technical (0-100)
       }

       // Work style
       interface WorkStyle {
         defaultDepth: number           // overview ↔ deep-dive (0-100)
         explanationStyle: 'examples' | 'analogies' | 'first-principles' | 'mixed'
         toolUsage: 'minimal' | 'moderate' | 'heavy'
         uncertaintyTolerance: 'cautious' | 'balanced' | 'bold'
       }

       // User relationship
       interface UserRelationship {
         addressForm: 'formal' | 'casual' | 'friendly'
         feedbackStyle: 'gentle' | 'balanced' | 'direct'
         proactivity: number  // reactive ↔ proactive (0-100)
         language: string     // e.g. 'en', 'pl'
       }

       // Archetype
       type ArchetypeId = 'developer' | 'researcher' | 'devops' | 'pm' | 'coach' | 'storyteller' | 'general' | 'custom'

       // Domain tags
       type Domain = 'coding' | 'research' | 'automation' | 'writing' | 'planning' | 'media'

       // The complete DNA object accumulated by the wizard
       interface AgentDNA {
         archetype: ArchetypeId | null
         temperament: Temperament
         communication: CommunicationStyle
         workStyle: WorkStyle
         userRelationship: UserRelationship
         domains: Domain[]
         primaryDomains: Domain[]  // max 2-3
       }

       // Wizard step tracking
       type WizardStep = 'archetype' | 'temperament' | 'communication' | 'work-style' | 'user-relationship' | 'domains' | 'summary'
       ```

    2. Create settings store (src/stores/settings-store.ts):
       - Use Zustand with `persist` middleware (localStorage key: 'soulgen-settings')
       - State: `mode: AppMode` (default 'simple'), `activeProvider: Provider` (default 'openai'), `providers: Record<Provider, ProviderConfig>` (defaults with empty keys and sensible default models: gpt-4o, claude-sonnet-4-20250514, openrouter/auto)
       - Actions: `setMode(mode)`, `setActiveProvider(provider)`, `setApiKey(provider, key)`, `setModel(provider, model)`
       - Handle Zustand persist hydration: export a `useSettingsHydrated` hook using `useStore` with `onFinishHydration`

    3. Create wizard store (src/stores/wizard-store.ts):
       - Use Zustand with `persist` middleware (localStorage key: 'soulgen-wizard')
       - State: `currentStep: WizardStep` (default 'archetype'), `dna: AgentDNA` (with sensible defaults — neutral temperament values at 50, balanced communication, etc.)
       - Actions: `setStep(step)`, `updateDNA(partial: Partial<AgentDNA>)`, `updateTemperament(partial)`, `updateCommunication(partial)`, `updateWorkStyle(partial)`, `updateUserRelationship(partial)`, `setArchetype(id)`, `toggleDomain(domain)`, `setPrimaryDomain(domain)`, `resetDNA()`
       - Same hydration pattern as settings store

    IMPORTANT: For Zustand persist with Next.js App Router, handle SSR hydration mismatch. Use the `skipHydration` option and a `useEffect`-based hydration hook pattern, OR use `onRehydrateStorage`. The key issue is that localStorage isn't available during SSR, so the store must handle the transition gracefully. A simple pattern:

    ```ts
    import { create } from 'zustand'
    import { persist, createJSONStorage } from 'zustand/middleware'

    export const useSettingsStore = create<SettingsState>()(
      persist(
        (set) => ({
          // ...state and actions
        }),
        {
          name: 'soulgen-settings',
          storage: createJSONStorage(() => localStorage),
        }
      )
    )
    ```

    Then create a hydration wrapper component or use `useSyncExternalStore` pattern to avoid hydration mismatches. The simplest approach: wrap store-dependent UI in a client component that doesn't render until mounted (useEffect + mounted state).
  </action>
  <verify>
    - `pnpm run build` passes (no TypeScript errors)
    - Types are exported and importable
    - Stores can be imported in a client component without errors
  </verify>
  <done>
    - All core types defined and exported from src/types/index.ts
    - Settings store persists mode and provider config to localStorage (PERS-01, PERS-02, MODE-03, MODE-04)
    - Wizard store persists DNA and step to localStorage (PERS-01, PERS-02)
    - Hydration handled for SSR/client mismatch
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm run build` succeeds without errors or warnings
- [ ] `pnpm run dev` starts and serves pages
- [ ] Types compile without errors
- [ ] shadcn/ui components render (button visible on homepage)
- [ ] Dark mode active by default
</verification>

<success_criteria>

- All tasks completed
- Next.js 15 app scaffolded with App Router, TypeScript, Tailwind, shadcn/ui
- Zustand stores with localStorage persistence created
- All core TypeScript types defined
- Project builds and runs without errors
  </success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
